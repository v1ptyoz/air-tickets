(()=>{"use strict";function t(t,n=0){const i=new Date(t);return i.setMinutes(i.getMinutes()+n),`${e(i.getHours())}:${e(i.getMinutes())}`}function e(t){return t<10?"0"+t:t}class n{url="https://front-test.beta.aviasales.ru/";id="";setId=async()=>{const t=await this.fetchData(this.url+"search");this.id=t.searchId};getTickets=async()=>await this.fetchData(this.url+`tickets?searchId=${this.id}`);fetchData=async t=>{let e=await fetch(t);return e.ok?await e.json():this.fetchData(t)}}document.addEventListener("DOMContentLoaded",(async function(){const i=new n;let c=[],s=[],a=0;const r=document.querySelector("button[name=more]");async function o(t){t.stop?c=[...t.tickets]:(c=[...t.tickets],await o(await i.getTickets()))}function l(n){const i=a+5;for(;a<i;)c=n[a++],document.querySelector(".tickets").innerHTML+=function(n){const{carrier:i,price:c,segments:s}=n,a=`http://pics.avs.io/99/36/${i}.png`;let r="";return s.forEach((n=>{var i,c,s,a,o;r+=(i=n.origin,c=n.destination,s=n.date,a=n.duration,o=n.stops,`\n            <li class="ticket__item">\n                ${function(e,n,i,c){return`\n        <div class="ticket__data" data-route>\n            <p>${e} - ${n}</p>\n            <p>${t(i)} - ${t(i,c)}</p>\n        </div>\n        `}(i,c,s,a)}\n                ${function(t){return`\n        <div class="ticket__data" data-lenght>\n            <p>В пути</p>\n            ${function(t){return`\n            <p>${e(Math.floor(t/60))}ч ${e(t%60)}м</p>\n        `}(t)}\n        </div>\n    `}(a)}\n                ${function(t){return t.length>0?`\n            <div class="ticket__data" data-stops>\n                <p>${t.length} ${function(t){const e=t%10;return e>10&&e<20?"пересадок":e>1&&e<5?"пересадки":1===e?"пересадка":"пересадок"}(t.length)}</p>\n                <p>${t.join(", ")}</p>\n            </div>\n            `:'\n            <div class="ticket__data" data-stops>\n                <p>Без пересадок</p>\n            </div>\n            '}(o)}\n            </li>\n        `)})),`\n    <li class="ticket">\n        ${function(t,e){return`\n            <div class="ticket__header">\n                <p class="ticket__price">${t} ₽</p>\n                <img class="ticket__img" src=${e} width="99" height="36">\n            </div>\n        `}(c,a)}\n        <div class="ticket__content">\n            <ul class="ticket__list">\n                ${r}\n            </ul>\n        </div>\n    </li>\n    `}(c);var c;document.querySelector(".spinner").style.display="none",r.style.display="inline-block",s=[...n]}function u(t,e){return t.price-e.price}function d(t,e){let n=t.segments.reduce((function(t,e){return t+e.duration}),0);return n<e.segments.reduce((function(t,e){return t+e.duration}),0)?-1:n>n?1:0}function p(){document.querySelector(".tickets").innerHTML="",a=0}r.style.display="none",await async function(){await i.setId(),await o(await i.getTickets()),s=[...c]}(),l(c.sort(u)),function(){r.addEventListener("click",(()=>{l(c)}));const t=document.querySelector("button[data-cheap]");t.addEventListener("click",(()=>{t.parentElement.classList.contains("time-filter__item--active")||(n(t),p(),l(s.sort(u)))}));const e=document.querySelector("button[data-fast]");function n(t){document.querySelectorAll(".time-filter__item").forEach((t=>t.classList.remove("time-filter__item--active"))),t.parentElement.classList.add("time-filter__item--active")}e.addEventListener("click",(()=>{e.parentElement.classList.contains("time-filter__item--active")||(n(e),p(),l(s.sort(d)))}));const i=document.querySelector(".search__form"),o=i.querySelectorAll("input[type=checkbox]");i.addEventListener("submit",(t=>{t.preventDefault()})),o.forEach((t=>{t.addEventListener("change",(e=>{var n;e.target.checked&&(a=0,"all"===e.target.dataset.stops?(p(),s=[...c],l(c),o.forEach((t=>t.checked=!1)),t.checked=!0):(n=e.target.dataset.stops,p(),document.querySelectorAll(".search__form input[type=checkbox]:checked").forEach((t=>{"all"!==t.dataset.stops&&l(c.filter((t=>{let e=0;return t.segments.forEach((t=>{e+=t.stops.length})),+n===e})))}))))}))}))}()}))})();